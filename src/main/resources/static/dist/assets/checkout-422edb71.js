import{_ as V,P as B,s as F,r as n,c as U,o as A,x as M,b as i,d as u,f as t,e as b,F as R,h as q,t as l,E as z,y as k,g as N,i as H,m as J,j as $,W as O,l as W,z as Y,p as G,k as K}from"./index-e86ed1bf.js";import{_ as Q}from"./progressbar-44c16b0d.js";const d=_=>(G("data-v-c427bc97"),_=_(),K(),_),X={class:"page-section"},Z={class:"container"},tt={class:"row justify-content-center mb-5 mt-5"},et=d(()=>t("hr",null,null,-1)),ot={class:"row justify-content-center mb-5"},st={class:"col-10 col-md-6 col-lg-6"},at={class:"row justify-content-center"},ct={class:"col-11 col-md-9 col-lg-8"},lt={class:"p-2 bg-light border"},nt={class:"table align-middle text-center"},dt=d(()=>t("thead",{class:"table-light"},[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"圖片"),t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"課程教練"),t("th",{scope:"col"},"課程時間"),t("th",{scope:"col"},"單價")])],-1)),rt={scope:"row"},it=["src"],ut=J('<div class="p-2 bg-light border" data-v-c427bc97><div class="form-floating" data-v-c427bc97><select class="form-select" id="floatingSelect" aria-label="Floating label select example" required data-v-c427bc97><option selected data-v-c427bc97>選擇付款方式</option><option value="1" data-v-c427bc97>信用卡-綠界金流</option><option value="2" data-v-c427bc97>LINE PAY</option></select><label for="floatingSelect" data-v-c427bc97>Pay with selects</label></div></div>',1),_t={class:"col-12 col-md-3 col-lg-2"},pt={class:"card"},vt={class:"card-body"},ht=d(()=>t("h4",{class:"card-title"},"總價:",-1)),mt={class:"card-text"},gt={key:0},bt={key:1},ft={class:"d-grid gap-3 col-12 mx-auto"},It=d(()=>t("hr",null,null,-1)),St={class:"row mx-auto"},yt=d(()=>t("h5",null,"優惠券",-1)),wt=d(()=>t("div",{id:"alertContainer",class:"alert-container"},null,-1)),xt={class:"col-12"},Ct=d(()=>t("label",{for:"inputPassword2",class:"visually-hidden"},"促銷代碼",-1)),kt={class:"row justify-content-center"},Nt=d(()=>t("button",{class:"btn btn-primary"},"回上頁",-1)),$t={__name:"checkout",setup(_){const h="http://localhost:8080/fithub",D=B(),{courseCartStore:L}=F(D),p=n([]),P=async()=>{const c=`${h}/classes/findClassesByIds`,o=await $.post(c,L.value).catch(a=>{console.log(a.toJSON())});p.value=o.data},f=n(!1),T=()=>{f.value=!0},v=n(""),s=n(""),I=n(""),S=n(""),y=n("");n("");const E=async()=>{try{const e=await $.get(`${h}/coupons/api/${v.value}`,{couponcode:v.value});if(e.status===200){console.log(e.data),s.value=e.data.coupondiscount,I.value=e.data.couponenddate,S.value=e.data.couponthreshold;const m=new Date,j=new Date(I.value),g=parseInt(e.data.couponused,10),x=parseInt(e.data.couponceil,10),C=parseInt(e.data.couponid,10);if(console.log(C),m>j)r("優惠已截止","alert-danger"),s.value="",localStorage.setItem("dis","0"),localStorage.setItem("used","0"),localStorage.setItem("cid","0");else if(w.value<S.value)r("總金額未達到使用門檻","alert-warning"),s.value="",localStorage.setItem("dis","0"),localStorage.setItem("used","0"),localStorage.setItem("cid","0");else if(console.log(g),console.log(x),g>=x)r("優惠券已用完","alert-danger"),s.value="",localStorage.setItem("dis","0"),localStorage.setItem("used","0"),localStorage.setItem("cid","0");else{var c=s.value;localStorage.setItem("dis",c),r("優惠碼已使用","alert-success");var o=g;localStorage.setItem("used",o);var a=C;localStorage.setItem("cid",a),console.log(a)}}else r("優惠券不存在","alert-danger"),s.value="",localStorage.setItem("dis","0"),localStorage.setItem("used","0"),localStorage.setItem("cid","0")}catch(e){console.error(e),r("優惠券不存在","alert-danger"),s.value="",localStorage.setItem("dis","0"),localStorage.setItem("used","0"),localStorage.setItem("cid","0")}};function r(c,o){const a=document.getElementById("alertContainer"),e=document.createElement("div");e.className=`alert ${o}`,e.textContent=c,a.innerHTML="",a.appendChild(e)}const w=U(()=>{let c=0;for(let o=0;o<p.value.length;o++)c+=p.value[o].price;return c});return A(()=>{P()}),(c,o)=>{const a=M("router-link");return i(),u("section",X,[t("div",Z,[t("div",tt,[et,t("div",ot,[t("div",st,[b(Q,{percent:50})])])]),t("div",at,[t("div",ct,[t("div",lt,[t("table",nt,[dt,(i(!0),u(R,null,q(p.value,(e,m)=>(i(),u("tbody",null,[t("tr",null,[t("td",rt,l(m+1),1),t("td",null,[N(t("img",{src:`${W(h)}/course/getImg?cid=${e.courseId}`,class:"cart-img-left mt-3",alt:"not Found",onLoad:T},null,40,it),[[O,f.value]])]),t("td",null,l(e.courseName),1),t("td",null,l(e.employeename),1),t("td",null,l(e.classDate)+" "+l(e.classTime),1),t("td",null,"NT$  "+l(e.price.toLocaleString()),1)])]))),256))])]),ut]),t("div",_t,[t("div",pt,[t("div",vt,[ht,t("p",mt," NT$ "+l((w.value-s.value).toLocaleString()),1),y.value?(i(),u("div",gt,l(y.value),1)):s.value?(i(),u("div",bt," 折扣 NT$ "+l(s.value),1)):z("",!0),t("div",ft,[b(a,{class:"btn btn-primary",to:"/ordercheck"},{default:k(()=>[Y("結帳")]),_:1})])]),It,t("div",St,[yt,wt,t("div",xt,[Ct,N(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),id:"inputPassword2",placeholder:"促銷代碼"},null,512),[[H,v.value]])]),t("div",{class:"col-12 my-2"},[t("div",{class:"row d-grid justify-content-end"},[t("div",{class:"col-12"},[t("button",{type:"submit",class:"btn btn-primary mb-3",onClick:E}," 輸入 ")])])])])]),t("div",kt,[b(a,{class:"col-8 my-4 text-center",to:"/cart"},{default:k(()=>[Nt]),_:1})])])])])])}}},Tt=V($t,[["__scopeId","data-v-c427bc97"]]);export{Tt as default};
