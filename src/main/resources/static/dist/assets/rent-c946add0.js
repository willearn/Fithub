import{_ as q,s as H,u as J,r,a as F,c as P,w as x,o as K,b as h,d as v,e as Q,f as t,g as C,v as V,F as T,h as k,i as W,j as D,S as p,t as u,p as X,k as tt}from"./index-e86ed1bf.js";import{C as et,i as st}from"./index-a474671c.js";import{u as ot}from"./rentorder-d2c30cf6.js";import{C as at}from"./Carousel-a86a19a5.js";const a=g=>(X("data-v-b2d42f2e"),g=g(),tt(),g),lt={class:"container text-center"},nt={class:"row justify-content-center"},rt={class:"col-lg-11 col-md-12"},ct=a(()=>t("h1",null,"場地租借",-1)),it=a(()=>t("hr",{class:"divider"},null,-1)),dt=a(()=>t("label",{class:"fs-3"},"場地:",-1)),ut=a(()=>t("option",{disabled:"",selected:"",value:"0"},"請先選擇場地",-1)),mt=["value"],_t=a(()=>t("label",{class:"fs-3"},"日期:",-1)),ht=["min","max"],vt=a(()=>t("label",{class:"fs-3"},"時段:",-1)),pt=a(()=>t("option",{disabled:"",selected:"",value:"0"},"請選擇時段",-1)),gt=a(()=>t("option",{value:"早上"},"早上9:00-12:00",-1)),ft=a(()=>t("option",{value:"下午"},"下午14:00-17:00",-1)),yt=a(()=>t("option",{value:"晚上"},"晚上18:00-21:00",-1)),bt=[pt,gt,ft,yt],Dt=a(()=>t("span",null,"*僅開放預訂下個月",-1)),St=a(()=>t("div",{id:"calendar",class:"calendar text-center mt-5"},null,-1)),wt={class:"container text-center"},xt=a(()=>t("h1",null,"場地介紹",-1)),Ct=a(()=>t("hr",{class:"divider"},null,-1)),Tt={class:"row justify-content-center"},At={class:"col-lg-11 col-md-12"},It={class:"table table-bordered align-middle"},Mt=a(()=>t("thead",null,[t("tr",{class:"table-success"},[t("th",null,"教室名稱"),t("th",null,"容納人數"),t("th",null,"介紹"),t("th",null,"租借價格"),t("th",null,"狀態"),t("th",null,"圖片")])],-1)),Ot={class:"col-lg-2 col-md-2"},Nt={class:"col-lg-2 col-md-2"},$t={class:"col-lg-2 col-md-2"},Bt={class:"col-lg-2 col-md-2"},Ft={class:"col-lg-2 col-md-2"},Pt={class:"col-lg-2 col-md-2"},Vt=["src"],kt={__name:"rent",setup(g){const f="http://localhost:8080/fithub",R=ot(),{selectedClassroom:E}=H(R),A=J(),S=new Date,w=new Date(S.getFullYear(),S.getMonth()+2,1);let I=w.getFullYear(),M=String(w.getMonth()).padStart(2,"0"),U=String(w.getDate()).padStart(2,"0");M==="01"&&I++;const O=`${I}-${M}-${U}`,c=r(0),i=r(O),d=r(0),N=r([]),y=r([]),$=r([]),m=r([]),l=F({rentOrderid:"",classroomid:"",classroomName:"",classroomPic:"",classroomPrice:"",rentdate:"",renttime:""}),_=F({memberid:localStorage.getItem("memberid"),classroomid:"",rentorderdate:S,rentdate:"",renttime:"",rentamount:"",rentstatus:"未付款"}),j=P(()=>{const s=new Date,e=new Date(s);return e.setMonth(s.getMonth()+1),e.setDate(1),e.toISOString().split("T")[0]}),L=P(()=>{const s=new Date,e=new Date(s);return e.setMonth(s.getMonth()+2),e.setDate(0),e.toISOString().split("T")[0]}),Y=async()=>{try{const s=await D.get(`${f}/classroom/list`);y.value=s.data,$.value=y.value.filter(e=>e.classroomStatus==="開放")}catch(s){console.error("Error:",s)}};x(c,s=>{G(s)}),x(i,s=>{}),x(d,s=>{});const z=async()=>{try{if(c.value===0){p.fire({title:"請選擇場地",icon:"warning",confirmButtonText:"確定"});return}else if(i.value===""){p.fire({title:"請選擇日期",icon:"warning",confirmButtonText:"確定"});return}else if(d.value===0){p.fire({title:"請選擇時段",icon:"warning",confirmButtonText:"確定"});return}if(l.classroomid=c.value,l.rentdate=i.value,l.renttime=d.value,(await D.post(`${f}/rent/checkClassroomAvailability`,l)).data===!0)p.fire({title:"已被預訂",icon:"error",confirmButtonText:"確定"});else if(m.value=y.value.find(n=>n.classroomId===l.classroomid),l.classroomName=m.value.classroomName,l.classroomPrice=m.value.classroomPrice,l.classroomPic=m.value.classroomPic,E.value=l,_.classroomid=c.value,_.rentdate=i.value,_.renttime=d.value,_.rentamount=m.value.classroomPrice,localStorage.getItem("isLogin")==="true"){const n=await D.post(`${f}/rent/insert`,_);l.rentOrderid=n.data,A.push({path:"/rentorder"})}else p.fire({title:"請登入會員",icon:"warning",confirmButtonText:"確定"}).then(n=>{n.isConfirmed&&A.push({path:"/login"})})}catch(s){console.error("Error:",s)}},G=async s=>{try{const o=(await D.get(`${f}/rent/list/${s}`)).data;N.value=o.map(b=>({title:`${b[1]}:已預定`,start:b[0]}));const n=document.getElementById("calendar");new et(n,{plugins:[st],headerToolbar:{left:"",center:"title",right:""},initialView:"dayGridMonth",initialDate:O,timeZone:"UTC",locale:"zh-tw",height:700,events:N.value,eventOrder:function(b,Z){const B={"早上:已預定":1,"下午:已預定":2,"晚上:已預定":3};return B[b.title]-B[Z.title]}}).render()}catch(e){console.error("Error:",e)}};return K(()=>{Y()}),(s,e)=>(h(),v(T,null,[Q(at),t("div",lt,[t("div",nt,[t("div",rt,[ct,it,dt,C(t("select",{class:"form-select-lg me-sm-5","onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),onChange:e[1]||(e[1]=(...o)=>s.handleOptionChange&&s.handleOptionChange(...o))},[ut,(h(!0),v(T,null,k($.value,o=>(h(),v("option",{key:o.name,value:o.classroomId},u(o.classroomName),9,mt))),128))],544),[[V,c.value]]),_t,C(t("input",{type:"date",class:"form-select-lg me-sm-5","onUpdate:modelValue":e[2]||(e[2]=o=>i.value=o),min:j.value,max:L.value},null,8,ht),[[W,i.value]]),vt,C(t("select",{class:"form-select-lg me-sm-5","onUpdate:modelValue":e[3]||(e[3]=o=>d.value=o)},bt,512),[[V,d.value]]),t("button",{type:"submit",class:"btn btn-primary btn-lg",onClick:z}," 預約 "),Dt,St])])]),t("div",wt,[xt,Ct,t("div",Tt,[t("div",At,[t("table",It,[Mt,t("tbody",null,[(h(!0),v(T,null,k(y.value,(o,n)=>(h(),v("tr",{key:n},[t("td",Ot,u(o.classroomName),1),t("td",Nt,u(o.classroomCapacity),1),t("td",$t,u(o.classroomDescription),1),t("td",Bt," $NT "+u(o.classroomPrice.toLocaleString()),1),t("td",Ft,u(o.classroomStatus),1),t("td",Pt,[t("img",{src:o.classroomPic,class:"img-fluid",alt:"維修中"},null,8,Vt)])]))),128))])])])])])],64))}},Yt=q(kt,[["__scopeId","data-v-b2d42f2e"]]);export{Yt as default};
