import{n as F,N,F as M,T as ee,r as p,O as se,b as m,d as y,f as e,t as u,e as b,l as _,_ as te,H as ae,u as oe,w as ne,P as le,s as P,Q as ce,a as re,U as ie,V as de,o as ue,g as me,W as pe,q as W,y as he,E as z,z as B,h as ge,j as g,X as ye,Y as ve,p as _e,k as fe}from"./index-e86ed1bf.js";import{c as be,C as Ce}from"./icon-cart-cbb87b19.js";import{a as Ie,C as we,i as Ae}from"./index-a474671c.js";import{C as Re}from"./Carousel-a86a19a5.js";const Se={headerToolbar:!0,footerToolbar:!0,events:!0,eventSources:!0,resources:!0},Be=F({props:{options:Object},data(){return{renderId:0,customRenderingMap:new Map}},methods:{getApi(){return this.calendar},buildOptions(o){return{...o,customRenderingMetaMap:Oe(this.$slots),handleCustomRendering:this.handleCustomRendering}}},render(){const o=[];for(const n of this.customRenderingMap.values())o.push(N(Me,{key:n.id,customRendering:n}));return N("div",{attrs:{"data-fc-render-id":this.renderId}},N(M,o))},mounted(){const o=new Ie;this.handleCustomRendering=o.handle.bind(o);const n=this.buildOptions(this.options),c=new we(this.$el,n);this.calendar=c,c.render(),o.subscribe(r=>{this.customRenderingMap=r,this.renderId++,this.needCustomRenderingResize=!0})},beforeUpdate(){this.getApi().resumeRendering()},updated(){this.needCustomRenderingResize&&(this.needCustomRenderingResize=!1,this.getApi().updateSize())},beforeUnmount(){this.getApi().destroy()},watch:ke()}),Ne=Be,Me=F({props:{customRendering:Object},render(){const o=this.customRendering,n=typeof o.generatorMeta=="function"?o.generatorMeta(o.renderProps):o.generatorMeta;return N(ee,{to:o.containerEl},n)}});function ke(){let o={options:{deep:!0,handler(n){let c=this.getApi();c.pauseRendering();let r=this.buildOptions(n);c.resetOptions(r),this.renderId++}}};for(let n in Se)o[`options.${n}`]={deep:!0,handler(c){if(c!==void 0){let r=this.getApi();r.pauseRendering(),r.resetOptions({[n]:c},[n]),this.renderId++}}};return o}function Oe(o){const n={};for(const c in o)n[Te(c)]=o[c];return n}function Te(o){return o.split("-").map((n,c)=>c?De(n):n).join("")}function De(o){return o.charAt(0).toUpperCase()+o.slice(1)}const xe={__name:"courseCalendar",props:{courseName:String,calendarEvents:Array},emits:["clickCalendarClassEmit"],setup(o,{emit:n}){const c=o;var r=new Date;r.setMonth(r.getMonth()+1),r.setDate(1);const C=p({plugins:[Ae],initialView:"dayGridMonth",weekends:!0,height:650,aspectRatio:1,initialDate:r,locale:"en-us",headerToolbar:{left:"",center:"title",right:""},titleFormat:{year:"numeric",month:"long"},events:[],eventColor:"#ffc408",interactive:!0,eventClick:v=>{let I=v.event._def.publicId;n("clickCalendarClassEmit",I)}});return se(()=>{C.value.events=c.calendarEvents}),(v,I)=>(m(),y(M,null,[e("h1",null,u(o.courseName)+"課程課表",1),b(_(Ne),{options:C.value},null,8,["options"])],64))}};const h=o=>(_e("data-v-d10d7bf6"),o=o(),fe(),o),$e={class:"container"},Le={class:"page-section",id:"courseDetail"},Ue={class:"row justify-content-center"},je={class:"col-12 text-center"},Ee={class:"card col-12 col-md-11 col-lg-10 h-100 mb-4"},Pe={class:"row justify-content-center align-items-center"},We={class:"col-5 mx-3"},ze=["src"],Fe={class:"col-6 mx-3"},Je={class:"my-3"},Ve={class:"row align-items-center"},Ye=h(()=>e("div",{class:"rol"},[e("div",null,"課程時間:")],-1)),Xe={class:"my-3"},qe={class:"my-3"},Ge={class:"my-3"},He={class:"ml-2 my-3"},Ke=h(()=>e("div",null,"課程說明:",-1)),Qe={class:"fs-6"},Ze={class:"ml-2 my-3"},es={key:0},ss={key:1},ts={key:2},as={class:"ml-2 my-3"},os={key:0,style:{color:"red","font-size":"medium"}},ns={class:"row justify-content-end my-4"},ls={class:"col-12 col-md-6 col-lg-4"},cs=h(()=>e("i",{type:"button",class:"bi bi-heart-fill"},null,-1)),rs={class:"col-12 col-md-6 col-lg-4"},is=h(()=>e("i",{type:"button",class:"bi bi-cart4"},null,-1)),ds={class:"col-12 col-md-6 col-lg-4"},us=h(()=>e("i",{type:"button",class:"bi bi-cart3"},null,-1)),ms=h(()=>e("hr",null,null,-1)),ps={class:"row justify-content-center"},hs={class:"col-12 col-md-10 col-lg-10"},gs=h(()=>e("hr",null,null,-1)),ys={class:"row justify-content-center"},vs={class:"col-12 col-md-10 col-lg-10"},_s=h(()=>e("h2",{class:"text-center"},"推薦課程",-1)),fs={class:"row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4 justify-content-center"},bs={__name:"courseDetail",setup(o){const n="http://localhost:8080/fithub",c=ae(),r=oe();ne(()=>c.params.courseid,async t=>{t!=null&&(await D(),await x())});const C=le(),{courseCartStore:v}=P(C),I=ce(),{courseWishlistStore:k}=P(I),s=re({classId:0,classDate:"",classTime:"",employeename:"",classroomName:"",price:"",applicantsCeil:"",alreadyBuyAmount:"",isMemberaAlreadyBuy:!1}),T=p([]),w=p([]),D=async()=>{const t=`${n}/course/${c.params.courseid}`,a=await g.get(t).catch(l=>{console.log(l.toJSON())});w.value=a.data},i=p([]),x=async()=>{const t=`${n}/classes/findAllClassesInMonthRange/${c.params.courseid}`,a=await g.get(t,{params:{monthBefore:1,monthAfter:1}}).catch(d=>{console.log(d.toJSON())});i.value=a.data;const l=await A(i.value[0].classId);i.value.length!=0&&(s.classId=i.value[0].classId,s.classDate=i.value[0].classDate,s.classTime=i.value[0].classTime,s.employeename=i.value[0].employeename,s.classroomName=i.value[0].classroomName,s.price=i.value[0].price,s.applicantsCeil=i.value[0].applicantsCeil,s.alreadyBuyAmount=l.data.orderAmount),T.value=i.value.map(d=>({id:d.classId,title:d.classTime,start:d.classDate})),localStorage.getItem("memberid")!=""&&(await R(i.value[0].classId),Object.keys(f.value).length!=0?s.isMemberaAlreadyBuy=!0:s.isMemberaAlreadyBuy=!1)},$=p([]),J=async()=>{if(localStorage.getItem("memberid")!=""){const t=`${n}/classes/findAllClassesInMemberWishlist`,a=await g.get(t,{params:{memberId:localStorage.getItem("memberid")}}).catch(l=>{console.log(l.toJSON())});$.value=a.data,K($)}},V=`${n}/order-items/getOrderItemAmountByClassId`,A=t=>g.get(V,{params:{classId:t}}).catch(a=>{console.log(a.toJSON())}),L=p([]),Y=async()=>{const t=`${n}/course/page`,a=await g.get(t,{params:{p:Math.floor(Math.random()*5)+1,size:3}}).catch(l=>{console.log(l.toJSON())});L.value=a.data},f=p([]),R=async t=>{const a=`${n}/orders/getAlreadyBuy`,l=await g.get(a,{params:{classId:t,memberId:localStorage.getItem("memberid")}}).catch(d=>{console.log(d.toJSON())});f.value=l.data},X=async t=>{let a=i.value.find(d=>d.classId==t);const l=await A(t);localStorage.getItem("memberid")!=""&&(await R(t),Object.keys(f.value).length!=0?s.isMemberaAlreadyBuy=!0:s.isMemberaAlreadyBuy=!1),s.classId=a.classId,s.classDate=a.classDate,s.classTime=a.classTime,s.employeename=a.employeename,s.classroomName=a.classroomName,s.price=a.price,s.applicantsCeil=a.applicantsCeil,s.alreadyBuyAmount=l.data.orderAmount},U=async t=>{if(s.applicantsCeil-s.alreadyBuyAmount<=0){S("可惜了","很抱歉，課程已經售完囉!");return}else{await A(s.classId);for(let a of v.value){const l=await A(a);if(l.data.applicantsCeil-l.data.orderAmount<=0){S("可惜了","很抱歉，課程已經售完囉!"),deleteCartItem(l.data.classId);return}}}if(localStorage.getItem("memberid")!=""&&(await R(s.classId),Object.keys(f.value).length!=0)){S("小提醒","您已經購買過本課程囉!");return}s.classId!=0&&!v.value.includes(s.classId)&&v.value.push(s.classId),t=="forward"?(console.log("forward"),r.push("/cart")):console.log("stay")},O=p(!1),q=()=>{O.value=!0,console.log("afterloaded")},G=async t=>{await g.post(`${n}/wishlist`,{memberId:localStorage.getItem("memberid"),classId:t}).catch(a=>{console.log(a.toJSON())})},H=async t=>{if(localStorage.getItem("memberid")=="")E("請先登入會員");else{if(await R(s.classId),Object.keys(f.value).length!=0){S("小提醒","您已經購買過本課程囉!");return}k.value.includes(t)?E("課程已存在您的願望清單"):(G(t),k.value.push(t),Z("課程已成功加入願望清單"))}},K=t=>{let a=[];for(let l=0;l<t.value.length;l++)a.push(t.value[l].classId);k.value=a},j=ie(),Q=de(),Z=t=>{j.success({title:"Success",content:t,positiveText:"確定"})},S=(t,a)=>{j.warning({title:t,content:a,positiveText:"確定"})},E=t=>{Q.info(t,{closable:!0,duration:5e3})};return ue(()=>{D(),x(),Y(),J()}),(t,a)=>(m(),y(M,null,[b(Re),e("div",$e,[e("section",Le,[e("div",Ue,[e("h1",je,u(w.value.courseName)+"課程",1),e("div",Ee,[e("div",Pe,[e("div",We,[me(e("img",{src:`${_(n)}/course/getImg?cid=${_(c).params.courseid}`,class:"card-img mt-3",alt:"not Found",onLoad:q},null,40,ze),[[pe,O.value]]),O.value?z("",!0):(m(),W(_(ve),{key:0,justify:"center",Align:"center"},{default:he(()=>[b(_(ye),{size:"large",stroke:"#ffc408"})]),_:1}))]),e("div",Fe,[e("div",Je,[e("div",Ve,[Ye,e("div",null,[e("span",null,u(s.classDate),1),B("   "),e("span",null,u(s.classTime),1)])])]),e("div",Xe,[e("div",null,"授課教練: "+u(s.employeename),1)]),e("div",qe,[e("div",null,"地點: "+u(s.classroomName),1)]),e("div",Ge,[e("div",null," 價格: NT$ "+u(s.price.toLocaleString()),1)]),e("div",He,[Ke,e("p",Qe,u(w.value.courseDescription),1)]),e("div",Ze,[s.alreadyBuyAmount!=null&&s.applicantsCeil<s.alreadyBuyAmount?(m(),y("div",es," 剩餘名額: 0 ")):s.alreadyBuyAmount!=null?(m(),y("div",ss," 剩餘名額: "+u(s.applicantsCeil-s.alreadyBuyAmount),1)):(m(),y("div",ts," 剩餘名額: "+u(s.applicantsCeil),1))]),e("div",as,[s.isMemberaAlreadyBuy?(m(),y("div",os," 您已經購買過本課程囉! ")):z("",!0)]),e("div",ns,[e("div",ls,[e("button",{class:"btn btn btn-primary mx-2",onClick:a[0]||(a[0]=l=>H(s.classId))},[cs,B("  加入願望清單 ")])]),e("div",rs,[e("button",{class:"btn btn btn-primary mx-2",onClick:a[1]||(a[1]=l=>U("stay"))},[is,B("  加入購物車 ")])]),e("div",ds,[e("button",{class:"btn btn btn-primary mx-2",onClick:a[2]||(a[2]=l=>U("forward"))},[us,B("  直接購買 ")])])])])])])]),ms,e("div",ps,[e("div",hs,[b(xe,{courseName:w.value.courseName,calendarEvents:T.value,onClickCalendarClassEmit:X},null,8,["courseName","calendarEvents"])])]),gs,e("div",ys,[e("div",vs,[_s,e("div",fs,[(m(!0),y(M,null,ge(L.value,(l,d)=>(m(),W(be,{class:"col-3 mx-2 my-3",cardAmount:d,course:l,URL:_(n)},null,8,["cardAmount","course","URL"]))),256))])])])])]),b(Ce)],64))}},Rs=te(bs,[["__scopeId","data-v-d10d7bf6"]]);export{Rs as default};
