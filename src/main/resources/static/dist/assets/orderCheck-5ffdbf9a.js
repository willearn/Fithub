import{_ as M,P,s as q,r as h,c as B,o as R,x as Y,b as g,d as v,f as o,e as w,F as j,h as E,t as c,l as F,y as H,j as d,p as U,k as O}from"./index-e86ed1bf.js";import{u as V,a as J}from"./index-4e694b90.js";import{_ as z}from"./progressbar-44c16b0d.js";const G="/assets/ECPAY-3c67ce30.png";const s=i=>(U("data-v-af3079ec"),i=i(),O(),i),K={class:"page-section"},Q={class:"container",style:{"padding-top":"10%","padding-bottom":"10%"}},W=s(()=>o("h1",{class:"text-center mb-5"},"訂單確認",-1)),X={class:"row justify-content-center mb-5"},Z={class:"col-10 col-md-6 col-lg-6"},oo={class:"row justify-content-center"},to={class:"col-11 col-md-9 col-lg-7 mydiv"},eo={class:"table caption-top"},so=s(()=>o("caption",null," 訂單項目 ",-1)),co=s(()=>o("thead",{class:"table-light"},[o("tr",null,[o("th",{scope:"col"},"#"),o("th",{scope:"col"},"課程名稱"),o("th",{scope:"col"},"課程教練"),o("th",{scope:"col"},"課程時間"),o("th",{scope:"col"},"單價")])],-1)),ao={scope:"row"},lo=s(()=>o("hr",null,null,-1)),no={class:"col-11 col-md-9 col-lg-7"},ro={style:{display:"flex","align-items":"center"}},io={class:"table caption-top"},uo=s(()=>o("blockquote",{class:"blockquote"},[o("small",{class:"text-muted"},"訂購人資訊")],-1)),_o={scope:"row"},po=s(()=>o("td",null,null,-1)),mo={scope:"row"},ho=s(()=>o("td",null,null,-1)),go={scope:"row"},vo=s(()=>o("td",null,null,-1)),yo=s(()=>o("div",null,[o("blockquote",{class:"blockquote"},[o("small",{class:"text-muted"},"付款方式")]),o("img",{src:G,style:{width:"200px",height:"auto"}})],-1)),bo={class:"col-12 col-md-3 col-lg-2"},fo={class:"card"},Co={class:"card-body"},Io=s(()=>o("h4",{class:"card-title"},"總價:",-1)),So={class:"card-text"},ko={class:"d-grid gap-3 col-12 mx-auto"},wo={class:"row justify-content-center"},xo=s(()=>o("button",{class:"btn btn-primary"},"回上頁",-1)),Do={__name:"orderCheck",setup(i){const n="http://localhost:8080/fithub",x=P(),{courseCartStore:y}=q(x),D=y.value,b=localStorage.getItem("cid"),u={orderDate:"",orderCondition:"未付款",memberId:localStorage.getItem("memberid"),orderTotalAmount:"",orderPaymentMethod:"Credit Card",orderstate:1,orderItem:D.map(t=>({classId:t,couponId:b}))},T=localStorage.getItem("memberid"),r=h({}),f=localStorage.getItem("dis"),$=async()=>{try{const t=T;console.log(t);const e=await d.get(`${n}/members/${t}`);r.value=e.data,console.log(r.value)}catch(t){console.error("獲取會員資料失敗",t)}},A=async()=>{try{const t=V(J(),"YYYY/MM/DD HH:mm:ss");console.log(t.value),u.orderDate=t.value,u.orderTotalAmount=C.value-f,console.log(u.orderTotalAmount);const e=await d.post(`${n}/orders`,u);console.log(e.data);const l=e.data,a={orderId:l.orderId,orderdate:l.orderDate,orderamount:l.orderTotalAmount};if(console.log(a),e.status===200){const S=(await d.post(`${n}/ecpay/ecpayCheckoutOrder`,a)).data;console.log(S);const p=document.createElement("div");p.style.display="none",p.innerHTML=S,document.body.appendChild(p);const k=p.querySelector("form");k?k.submit():console.error("找不到表单元素")}else console.error("請求失敗，狀態碼：",e.status)}catch(t){console.error("發生錯誤",t)}},m=h(parseInt(localStorage.getItem("used"))||0),N=async()=>{try{m.value+=1,console.log("使用量 "+m.value);const t=await d.put(`${n}/coupons/update/${b}`,null,{params:{couponused:m.value.toString()}});console.log("后端响应：",t.data)}catch(t){console.error("发送数据到后端时出错：",t)}},_=h([]),L=async()=>{const t=`${n}/classes/findClassesByIds`,e=await d.post(t,y.value).catch(l=>{console.log(l.toJSON())});_.value=e.data},C=B(()=>{let t=0;for(let e=0;e<_.value.length;e++)t+=_.value[e].price;return t});return R(()=>{L(),$()}),(t,e)=>{const l=Y("router-link");return g(),v("section",K,[o("div",Q,[W,o("div",X,[o("div",Z,[w(z,{percent:75})])]),o("div",oo,[o("div",to,[o("div",null,[o("table",eo,[so,co,(g(!0),v(j,null,E(_.value,(a,I)=>(g(),v("tbody",null,[o("tr",null,[o("th",ao,c(I+1),1),o("td",null,c(a.courseName),1),o("td",null,c(a.employeename),1),o("td",null,c(a.classDate)+" "+c(a.classTime),1),o("td",null,"NT$  "+c(a.price.toLocaleString()),1)])]))),256))])]),lo,o("div",no,[o("div",ro,[o("div",io,[uo,o("tr",null,[o("th",_o,"姓 名: "+c(r.value.membername),1),po]),o("tr",null,[o("th",mo,"電 話: "+c(r.value.memberphoneno),1),ho]),o("tr",null,[o("th",go,"信 箱: "+c(r.value.memberemail),1),vo])]),yo])])]),o("div",bo,[o("div",fo,[o("div",Co,[Io,o("p",So," NT$ "+c((C.value-F(f)).toLocaleString()),1),o("div",ko,[o("button",{onClick:e[0]||(e[0]=a=>{N(),A()}),class:"btn btn-primary"}," 結帳 ")])])]),o("div",wo,[w(l,{class:"col-8 my-4 text-center",to:"/checkout"},{default:H(()=>[xo]),_:1})])])])])])}}},No=M(Do,[["__scopeId","data-v-af3079ec"]]);export{No as default};
